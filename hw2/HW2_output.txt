MATRIX MULTIPLICATION

Note that C_ij = C[i+j*m], A_ip = A[i+p*m], and B_pj = B[p+j*k]. Thus to read sequentially along the arrays, 
C and A prefer to read along index i sequentially, and B prefers to read along index p sequentially. Thus the best
order for the loops is j p i (outside middle inner) , which is what MMult0 does. 


Matrix Multiplication Loop Order Output:
MMult0 does: j p i

MMult0 (j p i) vs MMult1 ( i p j) This should be the worst one

 Dimension       Time    
        16   1.047154 
        16   1.174739 

        64   1.204770
        64  12.861660

       112   1.122658
       112   5.018007

       160   1.098605
       160  11.729385


MMult0 (j p i) vs (p j i) This one should be comparable
 Dimension       Time
        16   1.348536
        16   1.495119

        64   1.593672
        64   1.902549

       112   1.305011
       112   2.037767

       160   1.369319
       160   2.019707

       208   1.177734
       208   1.824895

       256   1.377220
       256   1.911755

       304   1.350659
       304   1.740315


Peak FLOP rate is: CPU speed x number of CPU cores x CPU instructions per cycle
= 2.4 x 4 x 4 = 38.4 GHz

Optimal block size b is such that 2b^2 (both matrices A and B) fit into L1 cache, which has size 32 KB = 32000 bytes = 4000 doubles.
Thus we should expect that the optimal size is b=44. However it seems from the output below that the best FLOP rate is achieved with b=32. 
Interestingly, decreasing the number of threads to 2 did not decrease speed by a factor of 2 (compare second and third tables)


We now implement blocking (with optimal loop order j p i) and OpenMP
Block size = 40, num threads = 4
 Dimension       Time    Gflop/s       GB/s        Error
       480   0.500036   4.423362   2.225504 0.000000e+00
       520   0.452512   4.971642   2.500162 0.000000e+00
       560   0.387537   5.437919   2.733525 0.000000e+00
       600   0.352860   6.121408   3.076007 0.000000e+00
       640   0.393845   5.324822   2.674891 0.000000e+00
       680   0.453349   5.548603   2.786541 0.000000e+00
       720   0.343153   6.526208   3.276700 0.000000e+00
       760   0.464438   5.671062   2.846724 0.000000e+00
       800   0.372258   5.501554   2.761093 0.000000e+00
       840   0.408635   5.801788   2.911254 0.000000e+00
       880   0.469813   5.802070   2.910925 0.000000e+00
       920   0.481717   6.465932   3.243508 0.000000e+00
       960   0.672834   5.259759   2.638098 0.000000e+00
      1000   0.617396   6.478822   3.249129 0.000000e+00
      1040   0.384778   5.846827   2.931847 0.000000e+00
      1080   0.411615   6.120823   3.068913 0.000000e+00
      1120   0.432213   6.501090   3.259252 0.000000e+00
      1160   0.446325   6.994430   3.506260 0.000000e+00
      1200   0.531724   6.499609   3.257929 0.000000e+00
      1240   0.519095   7.345952   3.681862 0.000000e+00
      1280   0.695674   6.029126   3.021629 0.000000e+00
      1320   0.679683   6.767769   3.391575 0.000000e+00
      1360   0.854697   5.886192   2.949588 0.000000e+00
      1400   0.879047   6.243127   3.128253 0.000000e+00
      1440   0.953400   6.263865   3.138458 0.000000e+00
      1480   1.011627   6.409065   3.211028 0.000000e+00
      1520   1.041934   6.740938   3.377121 0.000000e+00
      1560   1.062852   7.143826   3.578782 0.000000e+00
      1600   1.272202   6.439227   3.225650 0.000000e+00
      1640   1.533789   5.751695   2.881108 0.000000e+00
      1680   1.414032   6.706542   3.359259 0.000000e+00
      1720   1.478586   6.882858   3.447432 0.000000e+00
      1760   1.631017   6.685125   3.348260 0.000000e+00
      1800   1.866904   6.247778   3.129096 0.000000e+00
      1840   1.889680   6.593185   3.301967 0.000000e+00
      1880   2.508388   5.297962   2.653208 0.000000e+00
      1920   2.213824   6.394265   3.202128 0.000000e+00
      1960   2.413798   6.238745   3.124147 0.000000e+00


Block size = 32, num threads = 4
 Dimension       Time    Gflop/s       GB/s        Error
       800   0.241685   8.473855   4.252816 0.000000e+00
       832   0.278230   8.279910   4.154883 0.000000e+00
       864   0.309030   8.348346   4.188667 0.000000e+00
       896   0.399190   7.207820   3.615977 0.000000e+00
       928   0.408100   7.833167   3.929245 0.000000e+00
       960   0.475475   7.442973   3.733116 0.000000e+00
       992   0.490285   7.964281   3.994183 0.000000e+00
      1024   0.330012   6.507296   3.263180 0.000000e+00
      1056   0.287620   8.188469   4.105866 0.000000e+00
      1088   0.327065   7.875578   3.948647 0.000000e+00
      1120   0.352879   7.962673   3.992001 0.000000e+00
      1152   0.421439   7.255262   3.637078 0.000000e+00
      1184   0.397515   8.350867   4.186013 0.000000e+00
      1216   0.406548   8.845439   4.433631 0.000000e+00
      1248   0.425289   9.140921   4.581447 0.000000e+00
      1280   0.595039   7.048789   3.532655 0.000000e+00
      1312   0.571259   7.906755   3.962417 0.000000e+00
      1344   0.662840   7.325194   3.670772 0.000000e+00
      1376   0.670725   7.768561   3.892749 0.000000e+00
      1408   0.707671   7.888726   3.952767 0.000000e+00
      1440   0.651404   9.167845   4.593472 0.000000e+00
      1472   0.813542   7.841038   3.928509 0.000000e+00
      1504   0.733755   9.273053   4.645775 0.000000e+00
      1536   0.927459   7.814635   3.914949 0.000000e+00
      1568   0.902013   8.547820   4.282087 0.000000e+00
      1600   0.988814   8.284674   4.150104 0.000000e+00
      1632   0.982127   8.851619   4.433945 0.000000e+00
      1664   1.167000   7.896219   3.955227 0.000000e+00
      1696   1.041817   9.365176   4.690871 0.000000e+00
      1728   1.249043   8.261972   4.138158 0.000000e+00
      1760   1.177696   9.258374   4.637078 0.000000e+00
      1792   1.447850   7.949147   3.981227 0.000000e+00
      1824   1.278077   9.496150   4.755885 0.000000e+00
      1856   1.478280   8.649821   4.331901 0.000000e+00
      1888   1.481278   9.086559   4.550499 0.000000e+00
      1920   1.850062   7.651515   3.831735 0.000000e+00
      1952   1.664586   8.936411   4.475073 0.000000e+00
      1984   1.810085   8.628911   4.320980 0.000000e+00



Block size = 32, num threads = 2
 Dimension       Time    Gflop/s       GB/s        Error
       800   0.329833   6.209194   3.116239 0.000000e+00
       832   0.394966   5.832711   2.926871 0.000000e+00
       864   0.396664   6.503963   3.263273 0.000000e+00
       896   0.532757   5.400759   2.709421 0.000000e+00
       928   0.470682   6.791670   3.406813 0.000000e+00
       960   0.595789   5.939930   2.979246 0.000000e+00
       992   0.602917   6.476453   3.248019 0.000000e+00
      1024   0.437203   4.911872   2.463131 0.000000e+00
      1056   0.367663   6.405780   3.211989 0.000000e+00
      1088   0.434744   5.924928   2.970632 0.000000e+00
      1120   0.439779   6.389246   3.203180 0.000000e+00
      1152   0.564147   5.419946   2.717030 0.000000e+00
      1184   0.500219   6.636282   3.326548 0.000000e+00
      1216   0.605112   5.942856   2.978759 0.000000e+00
      1248   0.589361   6.596173   3.306014 0.000000e+00
      1280   0.777247   5.396357   2.704502 0.000000e+00
      1312   0.694183   6.506654   3.260766 0.000000e+00
      1344   0.786923   6.170146   3.091959 0.000000e+00
      1376   0.793156   6.569413   3.291868 0.000000e+00
      1408   1.094878   5.098849   2.554857 0.000000e+00
      1440   0.998033   5.983737   2.998102 0.000000e+00
      1472   1.071179   5.955131   2.983634 0.000000e+00
      1504   1.084521   6.273870   3.143192 0.000000e+00
      1536   1.491156   4.860496   2.434995 0.000000e+00
      1568   1.235152   6.242344   3.127143 0.000000e+00
      1600   1.419097   5.772685   2.891755 0.000000e+00
      1632   1.484700   5.855336   2.933050 0.000000e+00
      1664   1.801460   5.115233   2.562228 0.000000e+00
      1696   1.540935   6.331744   3.171472 0.000000e+00
      1728   1.803855   5.720838   2.865385 0.000000e+00
      1760   1.731137   6.298490   3.154613 0.000000e+00
      1792   2.256733   5.099926   2.554232 0.000000e+00
      1824   1.951610   6.218871   3.114550 0.000000e+00
      1856   2.217812   5.765529   2.887424 0.000000e+00
      1888   2.082959   6.461825   3.236047 0.000000e+00
      1920   2.721136   5.202156   2.605142 0.000000e+00
      1952   2.395481   6.209786   3.109665 0.000000e+00
      1984   2.724034   5.733799   2.871235 0.000000e+00

______________________________________________________________
Gauss-Seidel + Jacobi 


GAUSS - SEIDEL, 4 threads
N=21
residual #1 = 28.023428
residual #2 = 26.662972
residual #3 = 25.632965
residual #4 = 24.768703
residual #5 = 24.009101
residual #6 = 23.323366
residual #7 = 22.693378
residual #8 = 22.107405
residual #9 = 21.557327
residual #10 = 21.037256
residual #11 = 20.542758
residual #12 = 20.070398
residual #13 = 19.617459
residual #14 = 19.181751
residual #15 = 18.761484
time = 0.008131

N=201
residual #1 = 282.590417
residual #2 = 281.231161
residual #3 = 280.201919
residual #4 = 279.338244
residual #5 = 278.579144
residual #6 = 277.893864
residual #7 = 277.264303
residual #8 = 276.678736
residual #9 = 276.129053
residual #10 = 275.609366
residual #11 = 275.115243
residual #12 = 274.643244
residual #13 = 274.190639
residual #14 = 273.755217
residual #15 = 273.335158
time = 0.081201

N=2001
residual #1 = 2828.175676
residual #2 = 2826.816493
residual #3 = 2825.787285
residual #4 = 2824.923630
residual #5 = 2824.164543
residual #6 = 2823.479273
residual #7 = 2822.849719
residual #8 = 2822.264158
residual #9 = 2821.714480
residual #10 = 2821.194798
residual #11 = 2820.700679
residual #12 = 2820.228684
residual #13 = 2819.776082
residual #14 = 2819.340663
residual #15 = 2818.920607
time = 1.619187

JACOBI

N=21
res 1 = 20.118400
res 2 = 19.531625
res 3 = 19.059528
res 4 = 18.653382
res 5 = 18.291478
res 6 = 17.961904
res 7 = 17.657290
res 8 = 17.372703
res 9 = 17.104645
res 10 = 16.850533
res 11 = 16.608392
res 12 = 16.376675
res 13 = 16.154141
res 14 = 15.939777
res 15 = 15.732743
time = 0.001441

N=201
res 1 = 200.124336
res 2 = 199.538334
res 3 = 199.066631
res 4 = 198.660764
res 5 = 198.299088
res 6 = 197.969714
res 7 = 197.665282
res 8 = 197.380864
res 9 = 197.112967
res 10 = 196.859008
res 11 = 196.617016
res 12 = 196.385443
res 13 = 196.163050
res 14 = 195.948825
res 15 = 195.741928
time = 0.083992

N=2001
res 1 = 2000.124934
res 2 = 1999.538990
res 3 = 1999.067308
res 4 = 1998.661453
res 5 = 1998.299785
res 6 = 1997.970416
res 7 = 1997.665989
res 8 = 1997.381574
res 9 = 1997.113680
res 10 = 1996.859724
res 11 = 1996.617734
res 12 = 1996.386163
res 13 = 1996.163772
res 14 = 1995.949548
res 15 = 1995.742653
time = 1.587338
