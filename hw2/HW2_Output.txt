MATRIX MULTIPLICATION

Note that C_ij = C[i+j*m], A_ip = A[i+p*m], and B_pj = B[p+j*k]. Thus to read sequentially along the arrays, 
C and A prefer to read along index i sequentially, and B prefers to read along index p sequentially. Thus the best
order for the loops is j p i (outside middle inner) , which is what MMult0 does. 


Matrix Multiplication Loop Order Output:
MMult0 does: j p i

MMult0 (j p i) vs MMult1 ( i p j) This should be the worst one

 Dimension       Time    
        16   1.047154 
        16   1.174739 

        64   1.204770
        64  12.861660

       112   1.122658
       112   5.018007

       160   1.098605
       160  11.729385


MMult0 (j p i) vs (p j i) This one should be comparable
 Dimension       Time
        16   1.348536
        16   1.495119

        64   1.593672
        64   1.902549

       112   1.305011
       112   2.037767

       160   1.369319
       160   2.019707

       208   1.177734
       208   1.824895

       256   1.377220
       256   1.911755

       304   1.350659
       304   1.740315


Peak FLOP rate is: CPU speed x number of CPU cores x CPU instructions per cycle
= 2.4 x 4 x 4 = 38.4 GHz

Optimal block size b is such that 2b^2 (both matrices A and B) fit into L1 cache, which has size 32 KB = 32000 bytes = 4000 doubles.
Thus we should expect that the optimal size is b=44. However it seems from the output below that the best FLOP rate is achieved with b=32. 
Interestingly, decreasing the number of threads to 2 did not decrease speed by a factor of 2 (compare second and third tables)


We now implement blocking (with optimal loop order j p i) and OpenMP
Block size = 40, num threads = 4
 Dimension       Time    Gflop/s       GB/s        Error
       480   0.500036   4.423362   2.225504 0.000000e+00
       520   0.452512   4.971642   2.500162 0.000000e+00
       560   0.387537   5.437919   2.733525 0.000000e+00
       600   0.352860   6.121408   3.076007 0.000000e+00
       640   0.393845   5.324822   2.674891 0.000000e+00
       680   0.453349   5.548603   2.786541 0.000000e+00
       720   0.343153   6.526208   3.276700 0.000000e+00
       760   0.464438   5.671062   2.846724 0.000000e+00
       800   0.372258   5.501554   2.761093 0.000000e+00
       840   0.408635   5.801788   2.911254 0.000000e+00
       880   0.469813   5.802070   2.910925 0.000000e+00
       920   0.481717   6.465932   3.243508 0.000000e+00
       960   0.672834   5.259759   2.638098 0.000000e+00
      1000   0.617396   6.478822   3.249129 0.000000e+00
      1040   0.384778   5.846827   2.931847 0.000000e+00
      1080   0.411615   6.120823   3.068913 0.000000e+00
      1120   0.432213   6.501090   3.259252 0.000000e+00
      1160   0.446325   6.994430   3.506260 0.000000e+00
      1200   0.531724   6.499609   3.257929 0.000000e+00
      1240   0.519095   7.345952   3.681862 0.000000e+00
      1280   0.695674   6.029126   3.021629 0.000000e+00
      1320   0.679683   6.767769   3.391575 0.000000e+00
      1360   0.854697   5.886192   2.949588 0.000000e+00
      1400   0.879047   6.243127   3.128253 0.000000e+00
      1440   0.953400   6.263865   3.138458 0.000000e+00
      1480   1.011627   6.409065   3.211028 0.000000e+00
      1520   1.041934   6.740938   3.377121 0.000000e+00
      1560   1.062852   7.143826   3.578782 0.000000e+00
      1600   1.272202   6.439227   3.225650 0.000000e+00
      1640   1.533789   5.751695   2.881108 0.000000e+00
      1680   1.414032   6.706542   3.359259 0.000000e+00
      1720   1.478586   6.882858   3.447432 0.000000e+00
      1760   1.631017   6.685125   3.348260 0.000000e+00
      1800   1.866904   6.247778   3.129096 0.000000e+00
      1840   1.889680   6.593185   3.301967 0.000000e+00
      1880   2.508388   5.297962   2.653208 0.000000e+00
      1920   2.213824   6.394265   3.202128 0.000000e+00
      1960   2.413798   6.238745   3.124147 0.000000e+00


Block size = 32, num threads = 4
 Dimension       Time    Gflop/s       GB/s        Error
       800   0.241685   8.473855   4.252816 0.000000e+00
       832   0.278230   8.279910   4.154883 0.000000e+00
       864   0.309030   8.348346   4.188667 0.000000e+00
       896   0.399190   7.207820   3.615977 0.000000e+00
       928   0.408100   7.833167   3.929245 0.000000e+00
       960   0.475475   7.442973   3.733116 0.000000e+00
       992   0.490285   7.964281   3.994183 0.000000e+00
      1024   0.330012   6.507296   3.263180 0.000000e+00
      1056   0.287620   8.188469   4.105866 0.000000e+00
      1088   0.327065   7.875578   3.948647 0.000000e+00
      1120   0.352879   7.962673   3.992001 0.000000e+00
      1152   0.421439   7.255262   3.637078 0.000000e+00
      1184   0.397515   8.350867   4.186013 0.000000e+00
      1216   0.406548   8.845439   4.433631 0.000000e+00
      1248   0.425289   9.140921   4.581447 0.000000e+00
      1280   0.595039   7.048789   3.532655 0.000000e+00
      1312   0.571259   7.906755   3.962417 0.000000e+00
      1344   0.662840   7.325194   3.670772 0.000000e+00
      1376   0.670725   7.768561   3.892749 0.000000e+00
      1408   0.707671   7.888726   3.952767 0.000000e+00
      1440   0.651404   9.167845   4.593472 0.000000e+00
      1472   0.813542   7.841038   3.928509 0.000000e+00
      1504   0.733755   9.273053   4.645775 0.000000e+00
      1536   0.927459   7.814635   3.914949 0.000000e+00
      1568   0.902013   8.547820   4.282087 0.000000e+00
      1600   0.988814   8.284674   4.150104 0.000000e+00
      1632   0.982127   8.851619   4.433945 0.000000e+00
      1664   1.167000   7.896219   3.955227 0.000000e+00
      1696   1.041817   9.365176   4.690871 0.000000e+00
      1728   1.249043   8.261972   4.138158 0.000000e+00
      1760   1.177696   9.258374   4.637078 0.000000e+00
      1792   1.447850   7.949147   3.981227 0.000000e+00
      1824   1.278077   9.496150   4.755885 0.000000e+00
      1856   1.478280   8.649821   4.331901 0.000000e+00
      1888   1.481278   9.086559   4.550499 0.000000e+00
      1920   1.850062   7.651515   3.831735 0.000000e+00
      1952   1.664586   8.936411   4.475073 0.000000e+00
      1984   1.810085   8.628911   4.320980 0.000000e+00



Block size = 32, num threads = 2
 Dimension       Time    Gflop/s       GB/s        Error
       800   0.329833   6.209194   3.116239 0.000000e+00
       832   0.394966   5.832711   2.926871 0.000000e+00
       864   0.396664   6.503963   3.263273 0.000000e+00
       896   0.532757   5.400759   2.709421 0.000000e+00
       928   0.470682   6.791670   3.406813 0.000000e+00
       960   0.595789   5.939930   2.979246 0.000000e+00
       992   0.602917   6.476453   3.248019 0.000000e+00
      1024   0.437203   4.911872   2.463131 0.000000e+00
      1056   0.367663   6.405780   3.211989 0.000000e+00
      1088   0.434744   5.924928   2.970632 0.000000e+00
      1120   0.439779   6.389246   3.203180 0.000000e+00
      1152   0.564147   5.419946   2.717030 0.000000e+00
      1184   0.500219   6.636282   3.326548 0.000000e+00
      1216   0.605112   5.942856   2.978759 0.000000e+00
      1248   0.589361   6.596173   3.306014 0.000000e+00
      1280   0.777247   5.396357   2.704502 0.000000e+00
      1312   0.694183   6.506654   3.260766 0.000000e+00
      1344   0.786923   6.170146   3.091959 0.000000e+00
      1376   0.793156   6.569413   3.291868 0.000000e+00
      1408   1.094878   5.098849   2.554857 0.000000e+00
      1440   0.998033   5.983737   2.998102 0.000000e+00
      1472   1.071179   5.955131   2.983634 0.000000e+00
      1504   1.084521   6.273870   3.143192 0.000000e+00
      1536   1.491156   4.860496   2.434995 0.000000e+00
      1568   1.235152   6.242344   3.127143 0.000000e+00
      1600   1.419097   5.772685   2.891755 0.000000e+00
      1632   1.484700   5.855336   2.933050 0.000000e+00
      1664   1.801460   5.115233   2.562228 0.000000e+00
      1696   1.540935   6.331744   3.171472 0.000000e+00
      1728   1.803855   5.720838   2.865385 0.000000e+00
      1760   1.731137   6.298490   3.154613 0.000000e+00
      1792   2.256733   5.099926   2.554232 0.000000e+00
      1824   1.951610   6.218871   3.114550 0.000000e+00
      1856   2.217812   5.765529   2.887424 0.000000e+00
      1888   2.082959   6.461825   3.236047 0.000000e+00
      1920   2.721136   5.202156   2.605142 0.000000e+00
      1952   2.395481   6.209786   3.109665 0.000000e+00
      1984   2.724034   5.733799   2.871235 0.000000e+00

______________________________________________________________
Gauss-Seidel + Jacobi  (4 threads)


JACOBI	
N=7
res 0 = 7.000000
res 1 = 6.103278
res 2 = 5.512769
res 3 = 5.037748
res 4 = 4.628852
res 5 = 4.264752
res 6 = 3.934684
res 7 = 3.632662
res 8 = 3.354981
res 9 = 3.099062
res 10 = 2.862912
res 11 = 2.644871
res 12 = 2.443490
res 13 = 2.257466
res 14 = 2.085615
res 15 = 1.926852
res 16 = 1.780177
res 17 = 1.644668
res 18 = 1.519474
res 19 = 1.403811
res 20 = 1.296952
res 21 = 1.198227
res 22 = 1.107018
res 23 = 1.022751
res 24 = 0.944899
res 25 = 0.872973
res 26 = 0.806522
res 27 = 0.745129
res 28 = 0.688409
res 29 = 0.636007
res 30 = 0.587594
res 31 = 0.542866
res 32 = 0.501543
res 33 = 0.463365
res 34 = 0.428094
res 35 = 0.395507
res 36 = 0.365401
res 37 = 0.337586
res 38 = 0.311889
res 39 = 0.288148
time = 0.000652

N=25
res 0 = 25.000000
res 1 = 24.119494
res 2 = 23.532889
res 3 = 23.060891
res 4 = 22.654821
res 5 = 22.292982
res 6 = 21.963468
res 7 = 21.658911
res 8 = 21.374378
res 9 = 21.106372
res 10 = 20.852311
res 11 = 20.610221
res 12 = 20.378553
res 13 = 20.156068
res 14 = 19.941752
res 15 = 19.734768
res 16 = 19.534410
res 17 = 19.340079
res 18 = 19.151263
res 19 = 18.967516
res 20 = 18.788451
res 21 = 18.613728
res 22 = 18.443044
res 23 = 18.276132
res 24 = 18.112753
res 25 = 17.952690
res 26 = 17.795751
res 27 = 17.641758
res 28 = 17.490552
res 29 = 17.341987
res 30 = 17.195929
res 31 = 17.052257
res 32 = 16.910857
res 33 = 16.771625
res 34 = 16.634466
res 35 = 16.499290
res 36 = 16.366015
res 37 = 16.234564
res 38 = 16.104866
res 39 = 15.976854
time = 0.000618

N=205
res 0 = 205.000000
res 1 = 204.124349
res 2 = 203.538349
res 3 = 203.066645
res 4 = 202.660779
res 5 = 202.299104
res 6 = 201.969729
res 7 = 201.665298
res 8 = 201.380880
res 9 = 201.112983
res 10 = 200.859024
res 11 = 200.617032
res 12 = 200.385459
res 13 = 200.163066
res 14 = 199.948841
res 15 = 199.741944
res 16 = 199.541673
res 17 = 199.347427
res 18 = 199.158695
res 19 = 198.975031
res 20 = 198.796049
res 21 = 198.621407
res 22 = 198.450804
res 23 = 198.283972
res 24 = 198.120672
res 25 = 197.960689
res 26 = 197.803828
res 27 = 197.649913
res 28 = 197.498785
res 29 = 197.350297
res 30 = 197.204316
res 31 = 197.060718
res 32 = 196.919391
res 33 = 196.780230
res 34 = 196.643138
res 35 = 196.508027
res 36 = 196.374812
res 37 = 196.243416
res 38 = 196.113766
res 39 = 195.985795
time = 0.001929

N=2005
res 0 = 2005.000000
res 1 = 2004.124934
res 2 = 2003.538990
res 3 = 2003.067308
res 4 = 2002.661454
res 5 = 2002.299785
res 6 = 2001.970416
res 7 = 2001.665989
res 8 = 2001.381574
res 9 = 2001.113680
res 10 = 2000.859724
res 11 = 2000.617734
res 12 = 2000.386163
res 13 = 2000.163772
res 14 = 1999.949548
res 15 = 1999.742653
res 16 = 1999.542382
res 17 = 1999.348138
res 18 = 1999.159407
res 19 = 1998.975744
res 20 = 1998.796763
res 21 = 1998.622122
res 22 = 1998.451520
res 23 = 1998.284689
res 24 = 1998.121390
res 25 = 1997.961408
res 26 = 1997.804548
res 27 = 1997.650634
res 28 = 1997.499506
res 29 = 1997.351019
res 30 = 1997.205038
res 31 = 1997.061441
res 32 = 1996.920115
res 33 = 1996.780955
res 34 = 1996.643864
res 35 = 1996.508753
res 36 = 1996.375539
res 37 = 1996.244144
res 38 = 1996.114494
res 39 = 1995.986524
time = 0.337096


GAUSS-SEIDEL
N=7
res 0 = 7.483315
res 1 = 8.886217
res 2 = 7.511440
res 3 = 6.470575
res 4 = 5.604341
res 5 = 4.862146
res 6 = 4.220421
res 7 = 3.663992
res 8 = 3.181090
res 9 = 2.761879
res 10 = 2.397927
res 11 = 2.081939
res 12 = 1.807591
res 13 = 1.569396
res 14 = 1.362590
res 15 = 1.183035
res 16 = 1.027141
res 17 = 0.891790
res 18 = 0.774274
res 19 = 0.672244
res 20 = 0.583660
res 21 = 0.506748
res 22 = 0.439971
res 23 = 0.381994
res 24 = 0.331657
res 25 = 0.287953
res 26 = 0.250008
res 27 = 0.217063
res 28 = 0.188460
res 29 = 0.163626
res 30 = 0.142064
res 31 = 0.123344
res 32 = 0.107090
res 33 = 0.092978
time = 0.000629

N=25
res 0 = 25.495098
res 1 = 34.382670
res 2 = 33.021611
res 3 = 31.991490
res 4 = 31.127166
res 5 = 30.367518
res 6 = 29.681746
res 7 = 29.051728
res 8 = 28.465727
res 9 = 27.915627
res 10 = 27.395536
res 11 = 26.901017
res 12 = 26.428629
res 13 = 25.975639
res 14 = 25.539838
res 15 = 25.119403
res 16 = 24.712817
res 17 = 24.318797
res 18 = 23.936252
res 19 = 23.564242
res 20 = 23.201954
res 21 = 22.848680
res 22 = 22.503799
res 23 = 22.166766
res 24 = 21.837099
res 25 = 21.514369
res 26 = 21.198197
res 27 = 20.888243
res 28 = 20.584203
res 29 = 20.285804
res 30 = 19.992800
res 31 = 19.704969
res 32 = 19.422110
res 33 = 19.144041
res 34 = 18.870594
res 35 = 18.601618
res 36 = 18.336974
res 37 = 18.076532
res 38 = 17.820175
res 39 = 17.567793
time = 0.000658

N=205
res 0 = 205.499392
res 1 = 288.953628
res 2 = 287.594295
res 3 = 286.565040
res 4 = 285.701359
res 5 = 284.942256
res 6 = 284.256973
res 7 = 283.627409
res 8 = 283.041840
res 9 = 282.492155
res 10 = 281.972467
res 11 = 281.478342
res 12 = 281.006342
res 13 = 280.553735
res 14 = 280.118312
res 15 = 279.698251
res 16 = 279.292034
res 17 = 278.898374
res 18 = 278.516176
res 19 = 278.144491
res 20 = 277.782498
res 21 = 277.429476
res 22 = 277.084790
res 23 = 276.747874
res 24 = 276.418226
res 25 = 276.095396
res 26 = 275.778976
res 27 = 275.468600
res 28 = 275.163933
res 29 = 274.864673
res 30 = 274.570540
res 31 = 274.281280
res 32 = 273.996659
res 33 = 273.716460
res 34 = 273.440483
res 35 = 273.168544
res 36 = 272.900469
res 37 = 272.636099
res 38 = 272.375284
res 39 = 272.117884
time = 0.002286

N=2005
res 0 = 2005.499938
res 1 = 2834.539559
res 2 = 2833.180368
res 3 = 2832.151159
res 4 = 2831.287504
res 5 = 2830.528417
res 6 = 2829.843146
res 7 = 2829.213592
res 8 = 2828.628031
res 9 = 2828.078353
res 10 = 2827.558671
res 11 = 2827.064552
res 12 = 2826.592557
res 13 = 2826.139955
res 14 = 2825.704536
res 15 = 2825.284479
res 16 = 2824.878266
res 17 = 2824.484610
res 18 = 2824.102414
res 19 = 2823.730733
res 20 = 2823.368744
res 21 = 2823.015725
res 22 = 2822.671041
res 23 = 2822.334128
res 24 = 2822.004484
res 25 = 2821.681656
res 26 = 2821.365239
res 27 = 2821.054865
res 28 = 2820.750201
res 29 = 2820.450943
res 30 = 2820.156813
res 31 = 2819.867556
res 32 = 2819.582937
res 33 = 2819.302740
res 34 = 2819.026766
res 35 = 2818.754828
res 36 = 2818.486756
res 37 = 2818.222388
res 38 = 2817.961575
res 39 = 2817.704177
time = 0.668709

